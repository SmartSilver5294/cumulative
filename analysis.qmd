---
title: "Cumulative"
author: "Ayush Chandra"
format: html
execute: 
  echo: false
  message: false
  warning: false
---


```{r}
#| message: false
#| warning: false
library(MASS)
library(tidyverse)
library(primer.data)
library(broom)
library(dplyr)
library(easystats)
library(readr)

x <- ces |>
  filter(year == 2020) |>
  select(approval, ideology, education) |>
  drop_na() |> 
  filter(! ideology %in% "Not Sure") |> 
  mutate(ideology = fct_drop(ideology))

fit_approval <- polr(approval ~ ideology + education,
                      data = x)

```

```{r}
x |>
  ggplot(aes(x = ideology, fill = approval)) +
  geom_bar() + labs(
  x = "Political Ideology",
  y = "Count",
  title = "Relationship Between President Approval and Political Ideology",
  subtitle = "Most people strongly dissaprove.", 
  caption = "Data from CES")
```

```{r}

x <- ces |>
  filter(year == 2020) |>
  select(approval, ideology, education) |>
  drop_na() |> 
  filter(! ideology %in% "Not Sure") |> 
  mutate(ideology = fct_drop(ideology))

fit_approval <- polr(approval ~ ideology + education,
                      data = x)
fit_approval |> 
    tidy(conf.int = TRUE)
```

```{r}
#| cache: true
tidy(fit_approval, conf.int = TRUE)
# Load gt for pretty tables
library(gt)

# Tidy model and show as gt table
fit_approval |>
  tidy(conf.int = TRUE) |>
  mutate(term = str_replace_all(term, "ideology|education", function(x) str_to_title(x))) |>
  gt() |>
  tab_header(
    title = "Ordinal Logistic Regression Results",
    subtitle = "Modeling Presidential Approval by Ideology and Education"
  ) |>
  fmt_number(
    columns = c(estimate, std.error, statistic, conf.low, conf.high),
    decimals = 3
  ) |>
  cols_label(
    term = "Predictor",
    estimate = "Estimate",
    std.error = "Std. Error",
    statistic = "z value",
    p.value = "p-value",
    conf.low = "95% CI Lower",
    conf.high = "95% CI Upper"
  ) |>
  tab_footnote(
    footnote = "Based on 2020 CES data; model estimated via `polr` from MASS.",
    locations = cells_title(groups = "title")
  ) |>
  opt_table_font(
    font = list(google_font("Lato"), default_fonts())
  )

```

$$P(Y \leq k) = \frac{1}{1 + e^{-(\alpha_k - \beta_1 \cdot \text{ideology} - \beta_2 \cdot \text{education})}}$$

with $Y \sim \text{Ordinal}(\boldsymbol{\rho})$ where $\boldsymbol{\rho} = (\rho_1, \rho_2, \ldots, \rho_K)$ are derived from the cumulative probabilities above.


The president is one of the most important people in the U.S. Using data from the 2020 CES, one of the largest political surveys in the U.S., we want to find how presidential approval is affected by different ideological groups. One concern is that survey respondents might be different from other Americans in their ideologies or thoughts about the president.  We are using a cumulative model for ordinal regression.
